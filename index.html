<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Inventario Pantallas y Bater√≠as - Firebase</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#020617;
  --panel:#0f172a;
  --panel-soft:#111827;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --primary:#38bdf8;
  --primary-hover:#0ea5e9;
  --green:#22c55e;
  --yellow:#facc15;
  --red:#ef4444;
}
*{ box-sizing:border-box }
body{ margin:0; font-family:system-ui, sans-serif; background:linear-gradient(135deg,#020617,#0f172a); color:var(--text); }
header{ padding:20px; border-bottom:1px solid var(--border); }
main{ padding:24px; max-width:1400px; margin:auto; }
.panel{ background:linear-gradient(180deg,var(--panel),var(--panel-soft)); border:1px solid var(--border); border-radius:14px; padding:20px; margin-bottom:20px; }
input,select,button{ padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#020617; color:var(--text); }
button{ background:var(--primary); color:#020617; font-weight:600; cursor:pointer; }
button:hover{ background:var(--primary-hover) }
table{ width:100%; border-collapse:collapse; margin-top:12px; }
th,td{ padding:12px; border-bottom:1px solid var(--border); }
.badge{ padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600; }
.pantalla{ background:rgba(34,197,94,.15); color:var(--green) }
.bateria{ background:rgba(250,204,21,.2); color:var(--yellow) }
.actions button{ margin-right:6px }
.in{ background:rgba(34,197,94,.25); color:var(--green) }
.out{ background:rgba(239,68,68,.25); color:var(--red) }
.del{ background:rgba(148,163,184,.2) }
details{ margin-top:12px; }
</style>
<!-- üîπ Firebase modular v10 -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getDatabase, ref, onValue, push, set, update, remove } 
    from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // Configuraci√≥n de Firebase
  const firebaseConfig = {
  apiKey: "AIzaSyAiQ-NtIyWp_CaAj8jjyuDLskzVOoV_H6g",
  authDomain: "control-de-inventario-633f5.firebaseapp.com",
  databaseURL: "https://control-de-inventario-633f5-default-rtdb.firebaseio.com",
  projectId: "control-de-inventario-633f5",
  storageBucket: "control-de-inventario-633f5.firebasestorage.app",
  messagingSenderId: "1012694355492",
  appId: "1:1012694355492:web:08a9ebccbff0c6620ed2b1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Variables globales
  let stock = [];
  let logs = [];
  let costs = [];
  let models = [
    'iPhone 8','iPhone 8 Plus','iPhone X','iPhone XR','iPhone XS','iPhone XS Max',
    'iPhone 11','iPhone 11 Pro','iPhone 11 Pro Max',
    'iPhone 12','iPhone 12 Pro','iPhone 12 Pro Max',
    'iPhone 13','iPhone 13 Pro','iPhone 13 Pro Max',
    'iPhone 14','iPhone 14 Pro','iPhone 14 Pro Max',
    'iPhone 15','iPhone 15 Pro','iPhone 15 Pro Max',
    'iPhone 16','iPhone 16 Pro','iPhone 16 Pro Max',
    'iPhone 17','iPhone 17 Pro','iPhone 17 Pro Max',
    'Samsung S21 Ultra','Samsung S22 Ultra','Samsung S23 Ultra','Samsung S24 Ultra','Samsung S25 Ultra'
  ];

  // Elementos DOM
  const modelInput = document.getElementById('model');
  const descInput = document.getElementById('desc');
  const typeSelect = document.getElementById('type');
  const addBtn = document.getElementById('addModel');
  const table = document.getElementById('table');
  const search = document.getElementById('search');
  const logsT = document.getElementById('logs');
  const costsT = document.getElementById('costs');
  const modelsList = document.getElementById('models');

  function refreshModels(){
    modelsList.innerHTML = models.map(m=>`<option value="${m}">`).join('');
  }
  refreshModels();

  // Escuchar stock
  onValue(ref(db,'stock'), snapshot=>{
    stock = [];
    snapshot.forEach(child=>stock.push({id: child.key, ...child.val()}));
    render();
  });

  // Escuchar logs
  onValue(ref(db,'logs'), snapshot=>{
    logs = [];
    snapshot.forEach(child=>logs.push(child.val()));
    render();
  });

  // Escuchar costs
  onValue(ref(db,'costs'), snapshot=>{
    costs = [];
    snapshot.forEach(child=>costs.push(child.val()));
    render();
  });
  addBtn.onclick = ()=>{
    const model = modelInput.value.trim();
    const desc = descInput.value.trim();
    const type = typeSelect.value;
    if(!model) return;

    if(!models.includes(model)){
      models.push(model);
      refreshModels();
    }

    if(stock.find(i=>i.model===model && i.type===type && i.desc===desc)) return;

    const newItemRef = push(ref(db,'stock'));
    set(newItemRef, { model, type, desc, qty: 0 });
    modelInput.value = '';
    descInput.value = '';
  };

  window.move = (id, dir)=>{
    const qty = parseInt(prompt('Cantidad'));
    if(!qty || qty <= 0) return;

    const item = stock.find(i=>i.id===id);
    if(dir==='out' && item.qty<qty){
      alert('Stock insuficiente');
      return;
    }

    if(dir==='in'){
      const price = parseFloat(prompt('Precio unitario de compra'));
      if(!price || price <=0) return;
      const newCost = { date: new Date().toLocaleString(), model:item.model, qty, price, total: qty*price };
      set(push(ref(db,'costs')), newCost);
    }

    set(push(ref(db,'logs')), {
      date: new Date().toLocaleString(),
      model: item.model,
      action: dir==='in'?'Entrada':'Salida',
      qty
    });

    update(ref(db,'stock/'+id), { qty: dir==='in'?item.qty+qty:item.qty-qty });
  }

  window.removeItem = (id)=>{
    const item = stock.find(i=>i.id===id);
    if(!item) return;
    if(!confirm(`Eliminar ${item.model} (${item.desc})?`)) return;
    remove(ref(db,'stock/'+id));
  }

  function render(){
    const s = search.value.toLowerCase();

    table.innerHTML = stock
      .filter(i=>!s || i.model.toLowerCase().includes(s))
      .map(i=>`
      <tr>
        <td>${i.model}</td>
        <td><span class="badge ${i.type}">${i.type}</span></td>
        <td>${i.desc||'-'}</td>
        <td>${i.qty}</td>
        <td class="actions">
          <button class="in" onclick="move('${i.id}','in')">‚ûï</button>
          <button class="out" onclick="move('${i.id}','out')">‚ûñ</button>
          <button class="del" onclick="removeItem('${i.id}')">üóëÔ∏è</button>
        </td>
      </tr>`).join('');

    logsT.innerHTML = logs.map(l=>`
      <tr>
        <td>${l.date}</td>
        <td>${l.model}</td>
        <td>${l.action}</td>
        <td>${l.qty}</td>
      </tr>`).join('');

    costsT.innerHTML = costs.map(c=>`
      <tr>
        <td>${c.date}</td>
        <td>${c.model}</td>
        <td>${c.qty}</td>
        <td>${c.price}</td>
        <td>${c.total}</td>
      </tr>`).join('');
  }

  search.oninput = render;
</script>
</head>
<body>
<header>
  <h2>Inventario de Pantallas y Bater√≠as</h2>
  <div style="color:var(--muted)">
    Con descripci√≥n y control interno de costos en la nube
  </div>
</header>

<main>
  <!-- Panel para agregar modelos -->
  <div class="panel">
    <h3>Agregar modelo</h3>
    <select id="type">
      <option value="pantalla">Pantalla</option>
      <option value="bateria">Bater√≠a</option>
    </select>
    <input id="model" list="models" placeholder="Modelo (ej: iPhone 11)">
    <input id="desc" placeholder="Descripci√≥n (ej: Con marco / OLED)">
    <datalist id="models"></datalist>
    <button id="addModel">Agregar</button>
  </div>

  <!-- Panel de inventario -->
  <div class="panel">
    <h3>Inventario</h3>
    <input id="search" placeholder="Buscar modelo">
    <table>
      <thead>
        <tr>
          <th>Modelo</th>
          <th>Tipo</th>
          <th>Descripci√≥n</th>
          <th>Cantidad</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="table"></tbody>
    </table>
  </div>

  <!-- Panel de historial -->
  <div class="panel">
    <h3>Historial de movimientos</h3>
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Modelo</th>
          <th>Acci√≥n</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody id="logs"></tbody>
    </table>

    <details>
      <summary>üìä Ver historial de costos (interno)</summary>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Modelo</th>
            <th>Cantidad</th>
            <th>Precio unitario</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="costs"></tbody>
      </table>
    </details>
  </div>
</main>

</body>
</html>
